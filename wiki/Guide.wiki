#labels Featured,Phase-QA
#软件使用的详细指南

=使用指南=

 # [http://code.google.com/p/luascript-for-acfunlocalizer/wiki/Guide#1._谁是适合阅读本文的小朋友们 谁是适合阅读本文的小朋友们？]
 # [http://code.google.com/p/luascript-for-acfunlocalizer/wiki/Guide#2._软件包功能简介 软件包功能简介]
 # [http://code.google.com/p/luascript-for-acfunlocalizer/wiki/Guide#3._如何在本地查找视频？如何挖掘节目列表当中� 如何在本地查找视频？如何挖掘节目列表当中的奥秘？——AcFunViewer]
  # [http://code.google.com/p/luascript-for-acfunlocalizer/wiki/Guide#3.1_基本操作 基本操作]
  # [http://code.google.com/p/luascript-for-acfunlocalizer/wiki/Guide#3.2_高级导出功能 高级导出功能]
  # [http://code.google.com/p/luascript-for-acfunlocalizer/wiki/Guide#3.3_模糊查询 模糊查询]
  # [http://code.google.com/p/luascript-for-acfunlocalizer/wiki/Guide#3.4_自定义评分系统 自定义评分系统]
  # [http://code.google.com/p/luascript-for-acfunlocalizer/wiki/Guide#3.5_聚类查询 聚类查询]
  # [http://code.google.com/p/luascript-for-acfunlocalizer/wiki/Guide#3.6_与其它程序的合作 与其它程序的合作]
 # [http://code.google.com/p/luascript-for-acfunlocalizer/wiki/Guide#4_如何下载视频弹幕？如何本地播放弹幕？如何�� 如何下载视频弹幕？如何本地播放弹幕？如何在移动播放设备上观看带弹幕的视频？还想下载其它网站？——AcFunLocalizer]
  # [http://code.google.com/p/luascript-for-acfunlocalizer/wiki/Guide#4.1_下载操作 下载操作]
  # [http://code.google.com/p/luascript-for-acfunlocalizer/wiki/Guide#4.2_弹幕转换功能 弹幕转换功能]
  # [http://code.google.com/p/luascript-for-acfunlocalizer/wiki/Guide#4.3_本地视频合并与修复 本地视频合并与修复]
  # [http://code.google.com/p/luascript-for-acfunlocalizer/wiki/Guide#4.4_播放器的选择与配置 播放器的选择与配置]
  # [http://code.google.com/p/luascript-for-acfunlocalizer/wiki/Guide#4.5_将ssa弹幕文件内嵌入视频 将ssa弹幕文件内嵌入视频]
  # [http://code.google.com/p/luascript-for-acfunlocalizer/wiki/Guide#4.6_下载其它网站内容 下载其它网站的内容]
  # [http://code.google.com/p/luascript-for-acfunlocalizer/wiki/Guide#4.7_使用代理及自动登录 使用代理及自动登录]
 # [http://code.google.com/p/luascript-for-acfunlocalizer/wiki/Guide#5_如何保存神弹幕？如何去除多余的评论？—— 如何保存神弹幕？如何去除多余的评论？——AcFunSubFilter]
  # [http://code.google.com/p/luascript-for-acfunlocalizer/wiki/Guide#5.1_删除无用评论 删除无用评论]
  # [http://code.google.com/p/luascript-for-acfunlocalizer/wiki/Guide#5.2_查找弹幕条目 查找弹幕条目]
  # [http://code.google.com/p/luascript-for-acfunlocalizer/wiki/Guide#5.3_偏移弹幕时间 偏移弹幕时间]
  # [http://code.google.com/p/luascript-for-acfunlocalizer/wiki/Guide#5.4_修改弹幕内容及属性 修改弹幕内容与属性]
 # [http://code.google.com/p/luascript-for-acfunlocalizer/wiki/Guide#6_我应当如何获得这些软件 我应当如何获得这些软件]

=1. 谁是适合阅读本文的小朋友们=
  * 不满足于AcFun自带的智能搜索或其它搜索工具的小朋友们
  * 想深度挖掘AcFun视频投稿中的若干不为人知的数据的小朋友们
  * 对AcFun自带收藏功能感到失望的小朋友们
  * 想把AcFun视频弹幕一起方便地下载到本地保存的小朋友们
  * 想在本地计算机上观看带弹幕效果视频的小朋友们
  * 想在手机/MP4/PSP或者其它移动视频播放设备上观看带弹幕效果视频的小朋友们
  * 用其它下载工具下载后视频仍不能本地播放或者视频是分段的小朋友们
  * 想自行修改已下载到的弹幕文件的小朋友们

=2. 软件包功能简介=

|| *英文名称* || *中文名称* || *主要功能* ||
|| AcFunViewer || 本地节目列表查询器 || 更新本地节目列表，多功能自定义智能查询，节目收藏，节目单导出 ||
|| AcFunLocalizer || 视频弹幕下载转换器 || 视频及弹幕下载，视频合并，视频修复，弹幕转换为本地可播放字幕，自动去黑屏 ||
|| AcFunSubFilter || 弹幕过滤器 || 查看弹幕，查询弹幕条目，删除弹幕条目||

=3. 如何在本地查找视频？如何挖掘节目列表当中的奥秘？——AcFunViewer=
一个月前看过一个视频，内容很好想跟网友分享却找不到了，ac自带的搜索和收藏功能都不好使；每天上来刷半天找最新更新的节目，能不能再简便一些操作；想把自己的收藏跟其他人共享；想深度挖掘节目列表中隐藏的信息，请阅读本节。

==3.1 基本操作==
AcFunViewer会在启动程序后自动与acfun网站同步节目列表，如果距离上次同步时间间隔过短，更新将不会进行。另外也可以点击“更新数据库”强制进行更新。更新时将在左下角的状态栏显示正在读取的列表，更新完成时会有对话框弹出确认，并在状态栏上显示更新完成字样。更新完成后，将在树状视图的最新更新后显示本次更新到的新节目数目。在更新过程中可以暂停和恢复，且关机后24小时内仍有效。

主界面左侧的树状视图除了acfun上的几个分类外，还增加了最近一周，查询结果，本次最新更新及收藏等几个新类别。点击最近一周，将按时间顺序显示最近7天内投稿通过的节目列表。

主界面右侧的列表视图将显示选定类别的节目单，每个节目将在此显示其在列表中的序号，节目投稿ID，节目名称，节目作者，投稿日期，点击量，评论数以及搜索得分（可以理解为搜索相关度）。在视图中可以使用ctrl及shift键辅助选定多个节目。在视图上右键将会弹出菜单，通过该菜单，可以完成在浏览器中打开选定节目，使用AcFunLocalizer下载选定节目（如果acfunlocalizer没有启动，程序会将其自动启动），收藏/取消收藏选定节目，导出选定节目列表等功能。点击每栏的表头，就可以按照该栏进行排序，再点一次表示按相反的顺序排序。

点击视图“属性栏”复选框，可以打开属性窗，属性窗将全面展示节目的上述属性外，还有节目地址以及节目简介，点击每个属性，都会在属性窗下方的描述栏出现完整的文本。

点击查找，将弹出查找悬停窗口，你可以拖动这个窗口让它浮动，也可以停靠在主窗口任意一侧。查找的基本功能里包含的参数有：在哪一类中查找（全部，动画，音乐，游戏，娱乐，番影，上次查找结果，当前列表显示），标题包含，作者包含，简介包含等。查找的高级功能中包含按日期查询，自定义查询以及聚类查询，后两者将在后面详述，为保证日期格式正确，日期查询不能直接输入日期，点击该行最右端的小按钮，将弹出一个日历选择框，请在该选择框中输入。

右上角的链接中包含了acfun首页链接以及本软件包更新地址链接。

==3.2 高级导出功能==
导出选定的节目列表，分享给好友或者发布到其它网站，甚至想导出数据到excel，格式化的问题很严重，每次都要手动输入修改粘贴，十分不便。使用高级导出功能将使一切变得十分方便。

为了导出节目列表，我们给每条节目的信息做一个格式化的模板，点击“编辑导出模板”，在弹出窗口中将可以看到现在使用的导出模板，默认为：

{{{
ID: $id 点击量: $clicknum 作者: $author

标题: $title

地址: $url

简介: $abstract

***************************************************************
}}}

带$前缀的是内部定义好的关键字，在编辑窗口中会以蓝色高亮显示，在输出时关键字将被它们代表的被输出节目的相应值代替。上面模板的含义很简单，即是把节目的id, 点击量，作者顺序输出到首行，第二行输出标题，第三行输出地址，第四行输出简介，最后一行的`**`表示在输出上述信息完毕后加一行`**`分隔。

在点击保存后选中要导出的节目条目，在右键菜单中选择导出文本是将导出内容复制到剪贴板上，然后到要粘贴的位置粘贴即可；选择导出到文件则是将导出内容输出到文件，建议在选择条数过多时采用导出到文件的方式，否则在一些配置不高的机器上有可能导致死机。

附，导出为excel格式的模板：

{{{
$id   $title         $author    $date        $clicknum         $commentnum         $url  $abstract
}}}
 

在导出节目列表中，可以使用的关键字及其作用如下表示：

===表格 1 自定义导出模板关键字列表===

|| *关键字*|| *含义* ||
|| $id || 节目ID ||
|| $shorturl || 从"/html/xxx"开始的地址 || 
|| $url || 包含"http://"的完整地址 ||
|| $title || 节目标题 ||
|| $date || 形如xxxx-xx-xx的日期 ||
|| $datenum || 节目自投稿日起至今的天数，当天的节目此值为1 ||
|| $author || 节目作者 ||
|| $abstract || 节目原始简介 ||
|| $abstract_singleline || 去掉了换行的单行节目简介 ||
|| $clicknum || 节目点击量 ||
|| $commentnum || 节目评论数 ||
|| $value || 查询时获得的评分或者自定义的分数 ||
|| $resultindex || 在当前显示列表中排列的序号 ||

==3.3 模糊查询==

如果勾选了配置中的模糊查询，则在查询时进入模糊查询的模式。

模糊查询和精确查询有什么区别？

精确查询是指查询的结果完全符合查询条件，比如搜作者名为”爱情上甘岭”的所有视频，那么将得到所有上老师的视频，外加一个”新月冰冰&爱情上甘岭”的视频节目。

模糊查询则是指只要所查找内容中包括与查找词中的一部分，就会被当作结果给出，比如上例中搜作者名为“爱情上甘岭”的所有视频，那么除了得到以上结果外，还会得到比如“爱情轻骑兵”等UP主们上传的视频。但是不必担心搜索的质量，搜索结果是以匹配度排序的，最上面的结果是最匹配的，也就是说即使选择模糊查询，搜“爱情上甘岭”的所有视频，“爱情轻骑兵”的视频是不可能排在上老师前面的。

搜索结果的匹配度由搜索得分栏显示。

==3.4 自定义评分系统==

如果填写了高级评分公式，那么搜索的结果将不按照内部的匹配度排序，将按照评分公式算出每个节目的分数，然后按降序排列。

可以参与评分公式的操作数可以是输入的实数，也可以是节目的某些属性（见表格2）。支持的运算包括四则运算，乘方，括号。约定加法符号为+, 减法为-, 乘法为`*`, 除法为/， 乘方为^。运算顺序为括号最先，其次是乘方，再次是乘除，最后的加减，从左到右计算。

比如说要查询平均每天点击量最高的节目，只要计算每个节目点击量除以投稿到现在的天数查询即可，所以自定义标准里就填入：

{{{
$clicknum/$datenum
}}}

可以参于运算的属性列表如下表所示：

===表格 2 自定义评分系统中的关键字列表===

|| *关键字* || *含义* ||
||$id||节目的id号||
||$index||节目在当前序列中的排列位置，最前面的序号为1，仅当查找类别为“当前显示”时才有效||
||$datenum||节目自投稿日起至今的天数，当天的节目此值为1||
||$clicknum||节目的点击量||
||$commentnum||节目评论数||
||$value||如果基本查询(标题作者简介)条件为空，该值为上次查询中该节目的得分；如果基本条件非空，则为本次查询后该节目的基本查询匹配度得分||

==3.5 聚类查询==

聚类就是说按照某一类元素相同的聚合为同一个，目前支持按作者，日期，月份或年份聚类。显示结果与普通查询略有不同，其结果的ID栏代表这一类别节目的总数，点击量与评论数则是此类别中所有节目的点击总量与评论总数。

举个简单的例子，要找到目前投稿数最多的作者，就把“在此类别中查找”选定为全部，然后将“按此类别聚类”选定为“作者”，点击查找，此时ID栏即为作者投稿数，点击量与评论总数则是此作者所有投稿的点击量与评论数。再按ID排序，即可找到最多的投稿者。

聚类时也可以使用自定义评分系统，但是表格2中的关键字不能直接使用在公式中，它们都需要写在$sum()或者$multi()的括号里面，这两个函数的含义如表3所示。计算时将对每一个节目计算函数括号中的表达式的值，然后将同一类别的所有节目的这一得分累加(sum)或累乘(multi)起来做为该函数的结果。注意，$sum和$multi不能嵌套，即不能出现$sum($sum(..))或$multi($sum(..))的形式。

===表格 3 聚类查询时自定义评分系统关键字列表===

|| *关键字* || *含义* ||
||$count||本类别中的节目个数||
||$sum(expression)||对同一类别中的节目每个先进行expression计算，然后将结果累加||
||$multi(expression)||类似$sum计算过程，只是最后一步变为累乘||

==3.6 与其它程序的合作==

从1.009版开始，viewer增加了对外部程序的调用功能。
  * 首先在列表中任意位置点右键，弹出菜单中最下一栏显示为：添加，执行，编辑，删除“外部命令”四项菜单。
  * 点击“添加”按钮则可以在弹出的对话框中填写外部调用的代码（命令行），比如如果要使用firefox打开链接，那么可以写：
{{{	   
"C:\Program Files\Firefox\firefox.exe" "$url"
}}}
  * 点击保存，系统会询问保存该外部命令的名称，比如填写“使用firefox打开”，保存后再右键打开菜单时，在执行、编辑及删除的列表中就出现了刚才保存的”使用firefox打开”这个外部命令。
  * 选中一系列节目，然后右键选择”执行外部命令”->”使用firefox打开”,viewer即可调用刚才指定的firefox打开这些链接。
  * 编辑与删除的功能如字面所述。
*注意*：在上面的例子中，firefox.exe的路径需要根据自己电脑上的实际路径设置，请使用绝对路径，并在路径名两端加上英文双引号（以免存在空格导致命令执行不正常）。另外，类似导出模板中的关键字定义，外部命令里也可以写$XXX的关键字，比如本例中就使用了$url,它表示节目网页的完整链接。

此外有一个开源的可以在线也可以离线播放视频弹幕的Flash系播放器mukioplayer，它可以读取xml弹幕播放。如果想使用它来直接播放viewer中显示的项目，也可以类似地使用上述方法实现。mukioplayer的项目主页：http://code.google.com/p/mukioplayer/

=4 如何下载视频弹幕？如何本地播放弹幕？如何在移动播放设备上观看带弹幕的视频？——AcFunLocalizer=

小提示：在程序主界面下按F1，可以看到帮助文档，其中的问与答中会有一些细节性的技术性问题，有可能你的问题就在其中，不要忘记遇到问题时先看看帮助。

==4.1 下载操作==

窗口上方的Ribbon菜单第一页主页中包含了常用的指令，下载指令包括：添加，批量添加，开始，停止，删除，更新。

在添加视频前如果复制了视频地址，添加时将自动填入视频地址并开始解析，也可以手动输入，如果解析成功，添加按钮将被点亮。另外不要忘记选一个保存目录，每次保存目录都默认为上一次保存的目录，所有使用过的目录都会在目录的下拉列表中，以方便以后使用。批量添加主要用于多P的视频，单P的也可以用，但解析会慢一些，在多P视频解析完成后，所有视频列表中的视频都会出现在下面的列表框中，点击每项前的复选框选择哪些进行下载，同时不要忘记选择一个合适的保存目录。对于分多段的视频，下载时会自动合并它们为一整个视频文件。

开始停止删除更新等功能需要选中相应的下载任务才能使用，其中，更新是指更新该任务的弹幕，更新下来的新弹幕将与原来的弹幕合在一起，也就是弹幕数量会比原来增加。需要注意的是，删除时不能删除正在下载的任务，你需要将正在下载的任务停止后再进行删除操作。

已下载视频节目较多查找不方便时，可以使用主页中包含的查找关键字功能，输入关键字后回车即可得到包含该关键字的视频节目信息。

在Ribbon菜单第二页配置中有下载的相关配置，包括acfun服务器的IP地址，是否下载视频，是否从IE缓存直接读已经缓存好的视频，下载时是否自动修复视频，以及下载的线程数（最多支持3个任务同时下载）。

在主列表中节目下载任务列表的属性显示为：任务下载状态，原始地址，保存名称，保存位置，开始下载时间，结束时间，下载速度，下载进度（包括百分比和已下载量显示）。其中任务下载状态使用↓表示正在下载的，√表示已经下载完成的，×表示以前下载过，但是因为种种原因出错没有下载完或转换完, T表示此任务已停止,除非重新开始下载,否则它不会自动下载; 任务状态为空白的,说明它进入了等待下载列表。

在任务列表中选中某任务点右键可以看到该任务的属性，其中将详细列中视频的原始地址以及字幕的地址。另外双击已完成的任务将可以直接打开该视频观看。

列表下方为日志栏，点击相应的任务可以看到其下载或转换的日志。

==4.2 弹幕转换功能==

本地弹幕转换功能是本软件的核心功能，在使用本软件下载视频时将会自动转换弹幕为本地可播放的ssa字幕，同时也可以选择性转换本地以前保存过的弹幕。注意在转换前选定好转换的各项参数。如果看不懂这些参数，基本上默认的也足够使用了。在调节的参数后可以使用配置－》转换配置－》保存设置来保存当前的设置参数，以后可以通过载入设置来恢复参数。所有可调节参数见下表4所示。

===表格 4 弹幕转换可调节的参数列表===

|| *可调节参数* || *作用* || *可取值* ||
||视频播放器版本||	选定弹幕的播放器版本以获得更精确的转换效果||	AcFun(`*`)， 旧AcFun，Niconico,Bilibili||
||字幕输出编码||	设定字幕输出的字符编码格式，比如Mplayer不能正常识别Unicode，此时可以采用UTF-8编码	||Unicode(`*`)， UTF-8||
||走马灯模式	||弹幕行为控制，选中表示转换后的结果将包括走马灯模式的弹幕||	选中(`*`),未选中||
||底端渐隐模式||	弹幕行为控制，选中表示转换后的结果将包括底端渐隐模式的弹幕||	选中(`*`),未选中||
||顶端渐隐模式||	弹幕行为控制，选中表示转换后的结果将包括顶端渐隐模式的弹幕||	选中(`*`),未选中||
||只转换特效弹幕||	在以上的选定范围内，去除白色的走马灯弹幕||选中,未选中(`*`)||
||弹幕退避||类似AcFun网站的碰撞检测，有效防止弹幕重叠在一起||选中(`*`),未选中||
|| *以下为高级参数设置* || || ||
||输出字体||	调节输出弹幕的显示字体||	本地已安装的所有字体，默认为黑体||
||输出大号字号||	最终播放弹幕时要看到的大号字的字体大小||	1-99，默认为37||
||输出中号字号||	最终播放弹幕时要看到的中号字的字体大小||	1-99，默认为25||
||输出小号字号||	最终播放弹幕时要看到的小号字的字体大小||	1-99，默认为15||
||输出大号字间距||	最终播放弹幕时要看到的大号字间的水平距离||	1-99，默认为2||
||输出中号字间距||	最终播放弹幕时要看到的中号字间的水平距离||	1-99，默认为1||
||输出小号字间距||	最终播放弹幕时要看到的小号字间的水平距离||	1-99，默认为1||
||输出大号字行间距||	最终播放弹幕时要看到的大号字行间的垂直距离||	1-99,默认为5||
||输出中号字行间距||	最终播放弹幕时要看到的中号字行间的垂直距离||	1-99,默认为10||
||输出小号字行间距||	最终播放弹幕时要看到的小号字行间的垂直距离||	1-99,默认为6||
||预设大号字大小||	读取弹幕时，大小为此值的被认为是大号字||	1-99，默认为37(*千万不要更改此项*)||
||预设中号字大小||	读取弹幕时，大小为此值的被认为是中号字||	1-99，默认为25(*千万不要更改此项*)||
||预设小号字大小||	读取弹幕时，大小为此值的被认为是小号字||	1-99，默认为15(*千万不要更改此项*)||
||走马灯显示时间||	从第一个字出现在屏幕起始到最后一个字消失的飞行时间，单位为秒||	任意正实数，默认为3.00||
||渐隐显示时间||	渐隐弹幕从开始出现到消失的显示时间，单位为秒||	任意正实数，默认为4.00||
||走马灯字幕的起始位置||	走马灯字幕第一个字出现时所在的水平位置，占视频宽度百分比，右端为100%||	1%-100%,默认为70%||
||视频宽高比||	原始视频宽与高的比值，对于某些比例不是4：3的视频，需要调整该项设置要始视频宽与高的比值||	默认为1.33333(4/3)||
||是否去除末尾半角空格||	是否去除末尾半角空格||	选中，未选中(`*`)||

==4.3 本地视频合并与修复==

本地视频合并指的是多P视频如果本来就是一个的话，可以使用这个功能连接，连接的同时要保证有同名xml弹幕文件与视频文件在同目录下。合并过程中将对其对应的弹幕文件同时进行合并，时间轴也会正常对齐。在合并前注意使用合并对话框右侧的”+”和”-”按钮调整合并列表中的视频顺序，合并将按从上到下的顺序合并。

本地视频修复是针对那些由于战渣浪的各种技术造成的下载到的视频（包括用其它下载器或者从缓存中直接复制出来的）不能正常播放而设计的。如果勾选了下载时自动修复，则下载完成后程序将自动尝试修复。也可以点击“修复本地无法播放的视频”来修复已经下载完成的视频。注意在修复前要选定修复配置选项。目前有两个选项，一是去除H263头，这种对应的是前1秒黑技术；另一种是去掉前黑，即经常见到的7分钟前黑等类似的黑屏视频。

修复如果去掉了7分钟前黑，那么字幕的时间也会相应地随之改变，不影响最终观看。

如果没有视频只想合并弹幕，那么目前只能靠手动操作，请参照第5.3章关于AcFunSubFilter偏移弹幕时间的介绍。

==4.4 播放器的选择与配置==

在视频弹幕下载并转换（包括修复）完成之后，可以使用电脑上的通用播放器来播放带有弹幕(ssa)的视频。注意，没有通用播放器可以直接加载xml弹幕播放。

目前可以比较流畅播放这种转换后的带ssa字幕视频的播放器包括：

===表格 5 推荐的播放器及解码器列表===

|| *播放器名称* || *备注* ||
||Windows Media Player||	需要另外安装Klite mega codec pack解码包，不需设置||
||Media Player Classic||	需要另外安装klite mega codec pack解码包，不需设置||
||迅雷看看播放器||	无需其他设置，但对某些bug压制的视频不支持||
||Kmplayer||需要少量设置（参见程序自带的帮助文档）||
||Mplayer||版本较多，据说WW编译版较好（不确定）||

不在此列表上的播放器，诸如暴风影音，QQ影音之类，可以播放视频，但是它们对ssa字幕标准支持不完善，无法得到流畅的弹幕效果。请选择列表中的播放器播放。

* 另外需要说明的问题：

  * 针对大量弹幕的情况，如亿千万类视频，推荐使用kmplayer播放，基本不会出现因为弹幕卡导致视音频不同步的现象，其它播放器容易出现因弹幕过多播放比较卡出现音视频不同步。在windows media player播放这类视频时如果出现音视频不同步，暂停再继续播放将修正这一问题。
  * 针对在acfun网页上播放时进度条快进的一类视频，目前只有使用kmplayer并设置其flv分离器为kmplayer分离器才可以正常播放。Windows media player播放此类视频会比较卡或者根本无法播放。但是对于以上播放器，都不能正常显示字幕，其原因主要为：flv封装的时间标签与实际视频时间不对应，造成进度条快进，在播放器上则表现为时间不同步，播放不正常。虽然kmplayer自家的分离器可以正常分离音视频，但是仍然无法正常显示字幕。对于这种视频，要想正常观看弹幕，需要使用flvextract将视音频分别提取出来，然后再使用ffmpeg重新封装为flv,或者是使用其它的转码工具转一下码即可。
  * 迅雷看看播放器在大多数情况下表现良好，但是它对某些加了前黑的视频播放花屏，即使修复后也是一样，请与其它播放器配合使用。

==4.5 将ssa弹幕文件内嵌入视频==

此功能不是本软件包提供的功能，但与本软件包相关。

  * 首先要准备AviSynth和meGUI软件，请自行搜索下载。

  * 写一个简单的avs脚本，比如：
{{{	   
DirectShowSource("flvname.flv",convertfps=true)
LoadPlugin("VSFilter.dll")
TextSub("flvname.xml.ssa")
}}}
  * 将其保存为一个.avs文件。确定使用media player classic播放器可以播放这个avs文件，再进行下一步操作，如果不能播放，请参考avisynth网站上的说明(英文)，或者找熟悉压制的朋友请教。

  * 打开meGUI软件，让其自动更新到最新版本。加载刚才的avs文件，选择压制的格式，更新完成后会有一些默认的设置列表，对应于psp, mp4, iphone等播放设备，可以直接选用。

  * 压制完成后就可以把压好的视频放在移动播放设备上观看了，另外也可以用此方法压制清晰的神弹幕视频分享给好友。

==4.6 下载其它网站内容==

在2.300版本的acfunlocalizer之后，修改了解析url的逻辑，由固化在程序中修改为使用lua脚本。如果你还想让acfunlocalizer支持其它网站，那么请看这一节有关脚本接口的介绍。

acfunlocalizer有两种添加任务模式，一种为单个添加，一种为批量添加。在添加对话框中被填入合法的url时，对话框将加载/luascript/add.lua脚本，并根据添加的模式执行lua脚本函数，由lua函数getTaskAttribute（单个添加）或getTaskAttributeBatch（批量添加）解析完成结果并返回。这两个入口函数仅名称不同，接口是一样的：

输入：
{{{	   
str_url:  string // is oriurl above
str_tmpfile: string // can be used(w+r) latter, which is a temp file
str_servername: string // only when acfun downloading it is used.
pDlg:   int    // a pointer to a internal C++ object, which can be used in following function.
}}}

输出为一个table(可以认为是lua中的数组）：
{{{	   
--[[tbl_re is a table indexed by string from "0" ,"1",...to "n"(tbl_re has n+1 elements).
every element is also a table, which can defined by:
element {
"acfpv"   :  int   // acfun player version whose value can be found in function 'getACFPV' in lalib.lua
"descriptor"  :  string  // dlfile name
"subxmlurl"  : string  // dlfile xml subtitles url. can be "", which means no subxmlurl.
"realurlnum" : int   // the following table"realurls" elements num
"realurls"  : table  // this is a table indexed by string from "0", "1",...to "n", every element is a string (real downloading url)
"oriurl"  : string  // orignial url
}]]
}}}

另外，在系统中还有几个供调试以及信息显示的接口：
{{{	   
these api is provided for debug:
sShowMessage(pDlg, string); //which can show string in newtask dlg.
dbgMessage(string); //popup a MessageBox to show the string. when the msgbox popuped, the script is suspended until u close the msgbox.
string utf8_to_lua(utf8string); //transfer utf8 string to lua string.
}}}

具体的流程请参考/luascript/add.lua以及/luascript/sitelist/文件夹下的脚本。/luascript/lib/下是公用的一些常用功能定义。

关于lua脚本语言的更多信息请参考http://www.lua.org

==4.7 使用代理及自动登录==

在ribbon页的网络设置页中，提供了这两种功能。

代理设置可以选择为：不使用代理，与IE相同设置，自定义设置，三种。当选择自定义设置时，下方的服务器地址，端口号，用户名，密码都开放可填写，没有用户名密码的留空。

自动登录功能是为了像bilibili.us（一部分视频需要）或者nicovideo.jp这样需要登录才可浏览的站点设计的。当然如果有担心自己的帐号密码不安全，你可以采用用IE窗口登录该网站后再添加任务下载，可以起到同样的作用。另外从2.502版本以后，引入了一种新的自动登录方法，通过 网络配置-帐号设置中的“设置”选项来设置各网站的帐号，勾选其中的自动登录即可在解析及下载时自动登录。在设置弹出的对话框中，注意无论是新添新站点还是修改以前的帐号，记得在修改完之后点“+”，然后再保存，否则无法保存。点“X”可以删除当前站点，注意对于bilibili和nico两个默认站点是无法删除的。*由于bilibili站点引入了登录验证码，目前自动登录功能已不可使用。*

=5 如何保存神弹幕？如何去除多余的评论？——AcFunSubFilter=

在压制字幕前想去除多余的评论，想保存最纯洁的神弹幕，想修改弹幕时间的偏移，那么请阅读本节。

本节只讨论如何修改xml弹幕文件，修改后的xml弹幕文件请使用localizer转换为ssa才能播放。另外记住，SubFilter只能删减不能增加！

*注意*：acfunsubfilter可以将弹幕保存为acfun,bilibili,nico任意一种格式，也可以选择：File->Save and translate菜单在保存后马上调用acfunlocalizer转换之。

==5.1 删除无用评论==

打开已经保存到本地的弹幕文件(xml格式)，每条弹幕都会在列表中以一行显示出来。显示属性包括：弹幕序号， 开始显示时间，弹幕内容，字体颜色， 字幕字号，字幕模式，评论时间。对于某些类型的弹幕文件，还有发表人ID这一项。

  * 弹幕序号指在弹幕文件中排列的顺序；

  * 开始显示时间指该条弹幕在播放时于第几秒开始出现；

  * 字体颜色除了用颜色的RGB值显示外，该栏的字体也将以此颜色标示；

  * 字幕字号指弹幕中指定的该条弹幕的字号，对于nico弹幕的big small这里只显示 3 2 1 ；

  * 字幕模式，1~3都表示走马灯模式，没有区别，4 5分别表示底端渐隐和顶端渐隐。6，7.。。等是bili或其它类型弹幕定义的特殊类型。

  * 在弹幕序号处有一个复选框，选中表示保留该条弹幕。在选定好要保留的弹幕后选择另存为即可保存过滤过的弹幕文件。

  * 为了使选择更加方便，工具栏中红色大A标志表示全选列表， 方框对号表示反选。

==5.2 查找弹幕条目==

工具栏上的绿色三角表示重新开始一个查询，红绿双箭头表示在上一个查询结果上继续查询。另外，向左向右两个黑箭头分别表示退回上一个或前进到下一个查询结果。在标题栏上会显示当前列表的查询条件。

在查询结果上勾选或勾掉弹幕复选框同样能达到保留或删除的效果。

目前支持的查询条件包括：

===表格 6 过滤器中支持的查询条件列表===

|| *查询条件* || *可输入的值* ||
||内容包含||	单个词，查询内容中包含这个词||
||内容不包含||	单个词，查询内容中不包含这个词||
||字幕显示模式||	填入列表中显示的字幕模式数字||
||字幕颜色||	填入6位RGB值，参照列表中的显示格式||
||字幕显示时间早于||	小数，显示时间，单位为秒||
||字幕显示时间晚于||	小数，显示时间，单位为秒||

==5.3 偏移弹幕时间==

使用菜单中的Edit->ShiftSubs可以给字幕加上整体时间偏移量，请按弹出对话框引导窗口提示操作。

在合并多个弹幕文件但没有对应的视频时，就需要先把排在后面的弹幕时间向后偏移后，然后将它们转换为ssa字幕，然后把后面的弹幕(ssa文件)中的Event部分中的以Dialogue:开头的行全部按先后顺序复制到第一个弹幕文件，保存后将此弹幕文件改名为与相关联的视频相同的名字。

==5.4 修改弹幕内容及属性==

支持单条修改及多条同时修改。注意，多条修改后会使这些弹幕被修改的属性相同，但是未改动的部分会保留原始状态，简单的一个应用就是把不同颜色的弹幕统一修改为同一颜色，等等。

具体操作方式为，选中要修改的弹幕，右键菜单中选择属性。在弹出窗口中改动需要的属性后点击“修改”按钮。

=6 我应当如何获得这些软件=
请访问
http://acfun.chunqing286.com
或
http://code.google.com/p/luascript-for-acfunlocalizer/