# AcFunLocalizer AcFun视频弹幕下载转换器 #

AcFun.tv和bilibili.tv是中文仿niconico【国内用户已不能访问】的两个视频网站，以其弹幕闻名。

虽然有一些下载视频或弹幕的软件,但下载下来在本地很难播放，虽然有一些网友做了基于flash的本地播放器，但其效率和方便性皆不尽人意, 且必须安装adobe的air环境。

你还在为不能下载保存AcFun和bilibili网站上的视频和弹幕苦恼吗？

你还在为不能本地播放弹幕伤心吗？

你还在为神字幕被破坏不能再次欣赏到而后悔吗？

你竟然还在使用fraps这样的录屏软件来保存弹幕视频!?

赶快试试AcFun视频字幕下载转换器，它是一款由网友自发编写的绿色无公害的免费软件,它既可以下载视频和弹幕，又可以转换弹幕为可以用通用播放器播放的字幕，并且配合其它的视频压制软件,可以让你获得比录屏更加方便快捷的获得弹幕效果的方法。

多任务同时下载, 利用ssa字幕高度还原AcFun与bilibili弹幕效果,现在还支持多个视频站点下载以及字幕解析转换,快来试用吧! BTW:吐槽程序名字禁止！=w=

# 更新发布页: #

http://acfun.chunqing286.com

http://code.google.com/p/luascript-for-acfunlocalizer/

旧的更新发布页

http://hi.baidu.com/chunqing286/blog

http://blog.sina.com.cn/chunqing286


# 声明 #
本程序为acfun爱好者自行开发使用，作者不对其因为不正当使用产生的一切后果负责。

程序中的一些组件为Microsoft公司提供。

程序中的ffmpeg.exe，avcodec.dll, avdevice.dll, avfilter.dll, avformat.dll, avutil.dll,pthreadGC2.dll,SDL.dll, swscale.dll，xvidcore.dll为中国FFmpeg工程组（http://www.ffmpeg.com.cn）发布的sdk中的一部分，程序中通过dll调用了该sdk中的一些功能。

程序中的脚本引擎为lua,可以从[此网站](http://www.lua.org)获得更多信息。

程序中的自动登录脚本技术上本身不会使第三方获得配置好的用户名和密码，但是存储时使用的是明文密码因此该配置文件安全性很低，应慎用。使用这种自动登录方式造成的帐号及一切损失皆由用户自行负责，与本程序及作者无关。

程序会自动收集使用者下载的视频地址信息，但除此以外不会收集用户的任何隐私信息，如果对您的隐私仍有顾虑，请不要使用本软件。


# 版权说明 #
本程序所有功能均免费，可以在既定接口的基础上做任何lua脚本扩展，扩展脚本的版权归脚本作者所有。但本程序所有二进制文件不允许反编译、修改等破解工作。
经由本程序转换得到的弹幕文件，著作权归原弹幕网站、原弹幕君以及Acfunlocalizer三者共同所有，允许使用者在转换弹幕基础上进行加工创作,二次加工过的弹幕文件的著作权仍然包括前文所述的三者以及加工者，同时在发布弹幕及相关作品时需标明该弹幕的所有权。
该版权说明最终解释权归chunqing286@gmail.com所有


# 爱好者请联系 #
chunqing286@gmail.com
用户讨论组:
QQ 群：112371869 177160288 195274315



v2.701

**修正了acfun新弹幕无法下载的错误。目前下载保存的格式为原Acfun xml格式，json格式的原始文本不予保存** 注意：如果转换后的弹幕缺失较多，请载入acfun201009配置手动转换。

v2.700

+ 增加了对2011年11月acfun json格式弹幕的下载与转换
**解决了http://www.acfun.tv/v/ac192783/转换效果失真的问题** 解决了一部分bili神弹幕转换后仍出现代码的错误

v2.608

**解决了一部分tudou源视频无法下载的问题
+ tudou视频下载默认为最高画质视频** 解决了一部分bili神弹幕转换后仍出现代码的错误

v2.607

+ 增加对bili指定字体和描边设置的转换

v2.606

**解决了一部分tudou源视频无法下载的问题**

v2.605

**修改了下载策略，可能会更加稳定** 根据acfun和bilibili更改域名做出了调整

v2.604

+ 增加打开任务视频原引用页面功能
+ 增加了下载acfun特殊弹幕的功能
+ 增加了转换acfun特殊弹幕的功能(测试中)
+ 增加了对acfun压缩弹幕的下载功能
**修正了一个会导致下载器下载弹幕时崩溃的bug** 适当简化了帐号设置的步骤，当修改完一个站点的帐号密码后可以直接点保存了
**增加了两个启动选项不更新可选**

v2.603

**修正了acfun网站弹幕下载不全的bug** 安装包解除，恢复绿色版,但是所有功能需要运行一次acfunlocalizer之后才可完全使用
**恢复对windows2000的支持**

v2.602

+ 增加了对acfun新弹幕格式的支持
+ 增加了对锁定弹幕的处理，可以单独转换，在xml保存格式上对acfun做了细微调整以适应锁定弹幕
+ 增加chunqing286://协议支持，便于调用下载功能
- 删除了acfun lock弹幕的下载临时文件
**修正了不能完整解析acfun弹幕的bug** 修改了打开文件夹的方法
**修改了新acfun和bilibili转换模式下只转换特效弹幕的行为为只转换锁定弹幕** 修正了新acfun多行弹幕定位的bug

v2.601

**修正了一个会漏转某些bilibili精准定位弹幕的bug**

v2.600b

+ 增加了标题栏的超链接显示功能
+ 增加了在标题栏每分钟显示一个本周热播视频的功能
+ 高级转换设置中增加了是否多层渲染的开关
**修正了一个导致自定义转换效果时第一行飞行弹幕错位的bug** 跟随acfun更改了弹幕下载方式，现在可以正确下载到acfun中被up主保护起来的弹幕了
**修改了任务列表文件格式，兼容老版本的格式** 修改了解析脚本中对弹幕返回结果的数据结构表示，更新了所有脚本

v2.505

+ 增加下载自动转换弹幕时根据视频真实宽高比进行转换，需要使用不同于原视频宽高比的时候请手动设置并转换。
+ 增加了命令行调用下载功能
+ 增加了一个自动转换宋体的字符
+ 增加了IE浏览器右键下载的支持
+ 增加了下载成功声音提示
**修改了行间距的代码，使基本三种定位方式的弹幕垂直方向定位更加准确。** 修改了自动登录打开后不能使用批量添加的bug
**修改了弹幕分层渲染，即使全部转换弹幕，神弹幕仍能得到较好展现** 减小了水印大小

v2.504

**增强了对bilibili神弹幕中多行精确定位像素画的转换效果，比如bilibili52094\_8
+ 增加了对bilibili最近的弹幕精准定位模式下的移动效果的支持
+ 在检查到有更新程序或更新脚本时，会提示当前版本号与最新版本号以供参考
+ 增加了解析六间房视频下载的脚本** 修改了解析acfun弹幕文件的脚本

v2.503

+ 增加对各站点帐号密码的加密措施
+ 增加设置自动登录以及站点帐号的UI界面，参见网络配置 - 帐号设置
+ 增加了nicovideo.jp的自动登录脚本
**增强了对bilibili神弹幕中的多行旋转的支持，比如bili52096
- 删去了直接在lua脚本中修改明文用户名及密码的做法**

v2.502

+ 为lua脚本增加了http安全连接的post接口
+ lua脚本中增加了自动登录bilibili网站的选项,在设定好用户名与密码后可在下载视频时自动登录帐号而不必使用IE窗口预先登录
**修改了一个下载目录被删除后再进行单个添加任务时内存耗尽的错误** 修改了一个导致mp4合并后没有声音的bug

v2.501

+ 对任务过长的保存路径检查并提示修正，长路径影响弹幕转换
**修改了引入断点续传时造成的下载器不稳定的几个bug** 修改了使用缓存的机制
**现在所有的hlv下载下来会自动将后缀更改为flv了**

v2.500

+ 增加了下载多段视频中断后重新下载时续传的功能
+ 增加了对单段视频的断点续传下载功能(只有服务器支持才可，sina与qq服务器均不支持)
**修改了程序图标为宅桐乃**

v2.408

**根据bili43243绿光补完计画调整了多行定位效果** 调整了逆向弹幕的多行定位
**调整了黑色字的勾边渲染** 修正了对hlv格式不能修复的bug,现在可以正确修复hlv后缀名的视频了
**删除了下载非flv格式合并时产生的0kb的flv文件**

v2.407

**修正了一个bilibili弹幕读取不完整的bug** 修正了对danmaku某些视频无法解析的bug

v2.406

+ 新增对sina视频解析下载的脚本
+ 新增对mikufans(现为danmaku）有关bilibili收藏视频弹幕的下载脚本
**修正了外链qq视频下载0字节的问题** 修正了一个在重新解析时可能引起崩溃的bug
**修正了对多行的精确定位弹幕转换效果
- 删除了转换bilibili弹幕时遗留下来的tmp文件**

v2.405

+ 新增对bilibili弹幕精准定位以及渐隐效果的支持（初步）
**修正了部分qq源视频的解析，目前可以正常下载了**

v2.404

**修正了外链地址使用了escape编码导致不能下载的bug.**

v2.403

**修正了对某些bilibili弹幕解析不完整的bug** 修正了对一些nico弹幕转换出视频画面之外的bug
**转换时对某些包含特殊字符的弹幕强制使用宋体，以避免黑体字体中没有而显示为方块的情况** 修正了批量解析bilibili弹幕时有可能出现空列表的bug
**修正了对土豆视频解析的一个小bug，原来有可能导致某些土豆视频无法解析**

v2.402

+ 增加了对换行行间距的设置，原来默认为0
+ 增加了一个对最近Acfun弹幕改版的转换设置，如果默认的转换效果不好请载入Acfun201009转换设置
**ac大百科更换新站后修改了相应的解析脚本** 修改了一个会导致bilibili渐隐弹幕短暂重叠的bug
**修正了更新bilibili弹幕时导致原有弹幕丢失的bug**

v2.401

+ 增加了重新解析任务时会删除任务原有下载内容的提醒，以避免删错文件
+ 增加了对bilibili逆向弹幕的转换支持
**修正了一个在下载多段非flv视频合并时出现0kb的错误** 调整了对bilibili底端渐隐模式弹幕的转换效果，还原度提高
**修正了一个bilibili弹幕转换时弹幕显示于播放窗口外（看上去是弹幕神隐了）的bug** 调整了bilibili的默认转换设置
- 取消了在选择编辑弹幕但subfilter未开启时弹出的“启动中”的窗口

v2.400

**缩减了程序体积** 修正了一个导致缓存文件冲突的错误
**修正了一个在下载的视频文件非flv格式时修复后漏掉了弹幕下载的错误** 修正了针对acfun批量下载时默认文件名过于重复的问题
**修改了程序图标**

v2.310

+ 增加了任务右键菜单“编辑弹幕”的功能，将自动在acfunsubfilter中打开该任务的弹幕
**修正了在某些情况下打开任务保存文件夹时不能正确导航的问题**

v2.309

+ 增加了重新下载时询问是否重新解析地址的选项
+ 下载youku,tudou视频时会自动获取标题了
**更改了删除任务时选择同时删除文件的实现方式，不会再跳出脚本提示** 修复了对某些youku和tudou源视频无法解析的错误脚本
**修复了某些情况下批量添加任务时导致程序崩溃的bug** 修复了某些外链地址书写不规范导致的下载错误的bug

v2.308a

**修复了一个在某些机器上解析flv文件的时候导致程序崩溃的错误，感谢网友azure提供帮助信息** 修复了一个在合并某些分段视频后修复时误将正常文件当做bug视频修复的错误

v2.307

+ 增加删除时询问是否删除下载文件的选项
**修改下载顺序，如果下载视频的话，视频下载将在弹幕下载前进行** 修正了由于上一版引入bilibili弹幕转换设置导致的设置不能正常保存的bug
**为自行添加下载其它站点内容的脚本增加了方便的接口**

v2.306

+ 增加了bilibili弹幕转换设置,以及bilibili播放器选择设置
+ 增加了有更新脚本可以使用时的更新提示
**修正了对某种特殊压制方法导致播放不能的bug.(1S前黑+进度条傲娇的变种,例如http://220.170.79.109/html/ent/20100707/117898.html, http://bilibili.us/plus/view.php?aid=6338 )** 修正了在自动合并及手动合并分段flv视频后,结果视频在pad以及格式工厂中只显示第一段时间的问题.
**修正了一个在解析flv文件metatag时使程序错误退出的bug.（对undefobject的解析）** 修改了配置里的几个图标，现在更美观一些了（自以为）
**修正了因为引入下载解析脚本导致的修改服务器IP后仍然不能解析的bug.**

v2.305

+ 增加了代理服务器设置(无代理,与IE相同代理,自定义代理设置三种选择)
+ 增加了对tw.nico的解析
+ 增加了根据保存名称查找已下载视频任务的功能
+ 增加了与acfunsubfilter的联动功能，在acfunsubfilter中可以直接调用localizer转换弹幕
**修正了对外链qqvideo与youku的解析,消除下载视频0kb的bug**

v2.304

+ 增加了对acfun, bilibili, nico下载视频时自动添加视频序号的功能.
**修正了在已完成列表中同时选中多项任务删除时出现异常退出程序的bug.** 修正了对acfun某些直接外链视频的解析
**修正了对外链qqvideo的解析** 修改了程序描述

v2.303

+ 增加了对非flv视频连接后的mpg文件压缩为mp4的代码，现在非flv视频连接的结果体积大大减小
+ 增加了自动检查版本更新的功能
**修正了youku脚本中对多段视频只能解析出来一段的bug** 修改了一些弹幕转换时的效果

v2.302

+ 增加了nicovideo视频(sm)以及弹幕解析下载，每次下载都必须重新添加任务，目前不能更新弹幕，关闭程序重新启动时任务也必须重新添加，请注意。（目前该功能处于测试阶段）
+ 增加了lua脚本post接口
**修改了批量添加时反复修改网页url导致解析出来的视频列表错误以及程序非正常关闭的bug** 修改了批量添加解析单个mikufans网站视频时出错
**修正了某些bilibili直接外链地址无法解析的错误** 进一步修正了弹幕转换时行与行错位的问题,但是对nico弹幕转换的支持仍不佳。

v2.301

+ 增加了批量添加下载时可以更改保存文件名的功能
**修正了bilibili下载脚本
+ 增加针对acfun对qqvideo站点视频外链网址的解析脚本
+ 增加针对bilibili对qqvideo和youku的新视频外链方法的解析脚本
+ 增加针对youku和qqvideo两个站点的视频网址解析，只支持单个添加** 对于战渣浪非熟练工压制出的某些怪异视频也可以修复了(囧)

v2.300

+ 默认自带acfun, bilibili, mikufans三个网站的视频弹幕下载解析脚本
**修改了添加任务时解析地址的引擎，改变以前固化逻辑，目前采取调用lua脚本实现** 修复了在某些外链地址书写不规范时造成任务列表混乱的bug
**修复了字幕转换时大号字与小号字混排时出现重叠的错误** 修改了字幕的默认名字，现在不再有.xml的字样，而直接文件名后接.ssa
**修改了字幕更新功能的运作方式，现在不在为每次更新到的弹幕新建文件，而是直接合并到原始弹幕当中，保持只有一个弹幕文件** 修改了水印，现在只添加一句水印
**修改了自带的几个转换设置的配置,应该没有鬼隐弹幕现象了**

v2.205

**修复了下载bilibili字幕时有时下载不完整的bug** 针对bilibili夏beta2的改版做了解析，“又”可以下载bilibili的视频和弹幕了

v2.204

**修复了由于上个版本中调整了已完成任务列表显示顺序导致无法正常显示任务日志的bug** 修复了非flv格式视频合并时出现输出文件大小为0kb的错误
**修复了将flv下载目录设置为系统盘根目录导致的退出后自动删除所有flv视频的bug**

v2.203

**将acfunIP默认设定为acfun的域名。** 下载列表中“下载速度”“下载进度”两项位置提前至保存名称之后， 原始地址调整至保存目录前。
**已完成列表现在排列顺序为已完成时间的倒序，便于寻找新下载的视频。**

v2.202

**修正了转换acfun弹幕时对空格的处理,目前不会再出现飞行错位,神字幕对不齐的现象** 修正了对一些字符画的转换效果,虽然比例上还有些不自然,但是不会出现乱七八糟看不出是什么的东西了
**修正了对底端渐隐模式字幕的渲染, 由顶端底端联合形成的阴影特效也可完美转换** 修改了底端渐隐顶端渐隐模式以及霸屏字幕的ssa代码,目前播放含这类弹幕较多的字幕处理器消耗降低
**修改了极小字号与背景色框的勾边方式** 减小了很多转换出来的ssa文件的体积
+ 对转换得到的字幕增加了4秒的水印,感谢大家支持.
+ 针对bilibili网站改版,修正了字幕下载,可以正常下载了
**修正了bilibili字幕换行的解析,但对bilibili的格式控制仍需调整,神弹幕转换效果不如Acfun完善.**

v2.201

**修改了因为UP主添加1S黑格式错误导致修复检测失效的问题,针对该问题做了新的检查** 修改了标题栏与帮助中的版本号
**修改了某些外链视频下载时出现无法创建文件导致程序崩溃的错误** 修改了批量添加下载时因手动填写了不存在的文件夹导致程序崩溃的错误,程序现在会自动创建不存在的文件夹

v2.200

+ 增加了正则表达式过滤弹幕功能,用法与网站上的正则表达式一样

v2.108

**修改了对某些被修复过的视频的真实地址解析** 完善了解析标题时出现的诸如&#XXXX;类似的字符，现在可以正常显示了

v2.107

+ 增加了下载时已下载字节数与大概的视频总体大小显示
**批量下载时也可以解析单个网页，利于被viewer调用**

v2.106

+ 增加了被AcFunViewer直接调用添加任务的功能
**修改了对网页代码页的处理，已支持繁体中文系统** 修复了某些bilibili视频找不到真实视频地址的错误

v2.105

+ 增加了缓存位置设置，具体设置方法见问与答
**修改了添加任务时使用www.bilibili.us做为网站地址无法开始解析的错误** 修改了对个别acfun任务解析出现的严重错误
**修改了某些情况下退出时无法完全清除缓存的bug**

v2.103

+ 增加了调试模式，当添加任务总是出现FLV ID的时候可以使用该模式添加，然后把debug.txt反馈给作者以确定问题所在
+ 增加了对bilibili网站收藏地址的解析，包括多Part批量添加
**将下载修复选项全部默认为开启** 修复了由于近期mikufans网站的修改导致得不到FLV ID的错误

v2.102

**修复了某些bilibili网站url解析的错误**

v2.101

+ 增加了对bilibili网站的支持，可批量下载，不支持逆向弹幕等非传统弹幕
+ 增加了对mikufans网站的支持
**修改了批量添加时不能改变保存目录的bug**

v2.100

+ 增加了对多part视频的批量添加下载
+ 增加了下载旧acfun播放器的视频时，自动临时载入旧acfun转换配置并转换弹幕的功能
**修改了一个解析旧acfun网站url时总是出现“无法读取FLV ID”的错误** 修改了自动下载时下载后处理时可能导致程序退出的bug
**修改了删除任务时有时删除不掉的bug** 修改了退出时自动释放系统缓存时询问保存还是运行的bug,现在不出现这一提示了

v2.007

+ 增加了退出时自动释放系统缓存的功能
+ 增加了在本地修复视频时剪去前置7分黑屏人参后，自动调整字幕时间的功能

v2.006

+ 增加了对某些异常的处理，提高了一些程序的稳定性
**修改了程序退出后图标滞留托盘的bug** 修改了下载引擎中可能引起程序崩溃的bug
**修改了不会记住上次所选的保存目录的bug** 修改了不能停止进入下载列表但还未开始下载的任务的bug

v2.005
+ 增加了系统托盘的支持
+ 限制程序只可以有一个实例
**修改了反复停止或反复重新下载导致的文件名过长的问题，现在重新下载会覆盖以前的文件，请注意自行备份**


v2.004
+ 增加修复flv本地视频功能，可以消除由于加载h263头导致不能播放的问题，也可以去除加入在视频前面的前置黑屏
+ 增加下载时自动修复视频功能
+ 增加修复选项设置，与下载时是否自动修复选项设置
**修改了程序窗口标题**


v2.003
+ 界面更改为ribbon界面，不再使用对话框
+ 增加了一个设置选项：是否去除末尾半角空格
+ 增加了下载日志中错误的描述
+ 增加了任务属性页
+ 增加了对诸如&#xxxx;的字符的解析
**对于文件名中的非法字符现在采用下划线代替，而不是用时间来命名** 重写了下载引擎
